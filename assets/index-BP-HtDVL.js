import{a as de,w as Q,e as X,G as me,x as ce,y as ge,b as _e,_ as fe,u as ve,g as he,h as be,i as ye,z as q,B as we,C as Ne,l as ke,N as xe}from"./business-DwE2IWgb.js";import{d as A,aB as z,aC as Y,y as Re,a as Z,$ as n,p as ee,r as Se,aD as Ue,c as T,o as w,w as t,f as a,aE as Ge,aF as Pe,h as e,q as ae,b as j,a4 as K,a5 as W,aH as ne,B as M,g as L,t as F,aI as Ee,ba as H,I as le,A as De,aK as $,a3 as J,aL as Ce}from"./index-Bp6mRz8i.js";import{u as se,a as te,b as oe,_ as Te}from"./form-D7purJ4S.js";import{_ as re}from"./Space-CWHWtDUx.js";import{_ as Be,a as $e,b as Oe,c as Me}from"./round-refresh-DLRRqMtJ.js";import{a as Le}from"./Grid-B_QeRqNj.js";const Fe=A({name:"UserOperateDrawer",__name:"user-operate-modal",props:z({operateType:{},rowData:{}},{visible:{type:Boolean,default:!1},visibleModifiers:{}}),emits:z(["submitted"],["update:visible"]),setup(h,{emit:G}){const d=h,R=G,c=Y(h,"visible"),{formRef:S,validate:p,restoreValidation:U}=se(),{defaultRequiredRule:y}=te(),{loading:P,startLoading:_,endLoading:m}=Re(),f=Z(()=>({add:n("page.manage.user.addUser"),edit:n("page.manage.user.editUser")})[d.operateType]),s=ee(N());function N(){return{username:"",password:"",userGender:null,nickName:"",userPhone:"",userEmail:"",userRoles:[],status:null}}const E={username:y,status:y,password:y},k=Se([]);async function b(){const{error:v,data:u}=await me();if(!v){const o=u.map(l=>({label:l.roleName,value:l.roleCode}));k.value=[...o]}}function D(){Object.assign(s,N()),d.operateType==="edit"&&d.rowData&&Object.assign(s,d.rowData)}function x(){c.value=!1}async function C(){var v,u,o;if(d.operateType==="add"){await p();const l={username:s.username,userGender:s.userGender,nickName:s.nickName,userPhone:s.userPhone,userEmail:s.userEmail,userRoles:s.userRoles,password:s.password,status:s.status};_();const{error:r}=await ce(l);r||((v=window.$message)==null||v.success(n("common.addSuccess")),x(),R("submitted")),m()}else if(d.operateType==="edit"){await p();const l={uuid:(u=d.rowData)==null?void 0:u.uuid,username:s.username,userGender:s.userGender,nickName:s.nickName,userPhone:s.userPhone,userEmail:s.userEmail,userRoles:s.userRoles,status:s.status};_();const{error:r}=await ge(l);r||((o=window.$message)==null||o.success(n("common.updateSuccess")),x(),R("submitted")),m()}}return Ue(c,()=>{c.value&&(D(),U(),b())}),(v,u)=>{const o=ae,l=Te,r=_e,B=de,I=ne,g=oe,ue=Ge,V=M,ie=re,pe=Ee;return w(),T(pe,{show:c.value,"onUpdate:show":u[8]||(u[8]=i=>c.value=i),title:f.value,preset:"card",class:"w-600px"},{footer:t(()=>[a(ie,{size:16,justify:"end"},{default:t(()=>[a(V,{onClick:x},{default:t(()=>[L(F(e(n)("common.cancel")),1)]),_:1}),a(V,{type:"primary",loading:e(P),onClick:C},{default:t(()=>[L(F(e(n)("common.confirm")),1)]),_:1},8,["loading"])]),_:1})]),default:t(()=>[a(ue,{class:"h-408px pr-20px"},{default:t(()=>[a(g,{ref_key:"formRef",ref:S,model:s,rules:E,"label-placement":"left","label-width":100},{default:t(()=>[a(l,{label:e(n)("page.manage.user.username"),path:"username"},{default:t(()=>[a(o,{value:s.username,"onUpdate:value":u[0]||(u[0]=i=>s.username=i),placeholder:e(n)("page.manage.user.form.username"),disabled:d.operateType==="edit"},null,8,["value","placeholder","disabled"])]),_:1},8,["label"]),a(l,{label:e(n)("page.manage.user.userGender"),path:"userGender"},{default:t(()=>[a(B,{value:s.userGender,"onUpdate:value":u[1]||(u[1]=i=>s.userGender=i)},{default:t(()=>[(w(!0),j(K,null,W(e(Q),i=>(w(),T(r,{key:i.value,value:i.value,label:e(n)(i.label)},null,8,["value","label"]))),128))]),_:1},8,["value"])]),_:1},8,["label"]),a(l,{label:e(n)("page.manage.user.nickName"),path:"nickName"},{default:t(()=>[a(o,{value:s.nickName,"onUpdate:value":u[2]||(u[2]=i=>s.nickName=i),placeholder:e(n)("page.manage.user.form.nickName")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(l,{label:e(n)("page.manage.user.userPhone"),path:"userPhone"},{default:t(()=>[a(o,{value:s.userPhone,"onUpdate:value":u[3]||(u[3]=i=>s.userPhone=i),placeholder:e(n)("page.manage.user.form.userPhone")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(l,{label:e(n)("page.manage.user.userEmail"),path:"email"},{default:t(()=>[a(o,{value:s.userEmail,"onUpdate:value":u[4]||(u[4]=i=>s.userEmail=i),placeholder:e(n)("page.manage.user.form.userEmail")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(l,{label:e(n)("page.manage.user.userStatus"),path:"status"},{default:t(()=>[a(B,{value:s.status,"onUpdate:value":u[5]||(u[5]=i=>s.status=i)},{default:t(()=>[(w(!0),j(K,null,W(e(X),i=>(w(),T(r,{key:i.value,value:i.value,label:e(n)(i.label)},null,8,["value","label"]))),128))]),_:1},8,["value"])]),_:1},8,["label"]),a(l,{label:e(n)("page.manage.user.userRole"),path:"roles"},{default:t(()=>[a(I,{value:s.userRoles,"onUpdate:value":u[6]||(u[6]=i=>s.userRoles=i),multiple:"",options:k.value,placeholder:e(n)("page.manage.user.form.userRole")},null,8,["value","options","placeholder"])]),_:1},8,["label"]),d.operateType==="add"?(w(),T(l,{key:0,label:e(n)("page.manage.user.password"),path:"password"},{default:t(()=>[a(o,{value:s.password,"onUpdate:value":u[7]||(u[7]=i=>s.password=i),placeholder:e(n)("page.manage.user.form.password")},null,8,["value","placeholder"])]),_:1},8,["label"])):Pe("",!0)]),_:1},8,["model"])]),_:1})]),_:1},8,["show","title"])}}}),Ie=A({name:"UserSearch",__name:"user-search",props:{model:{required:!0},modelModifiers:{}},emits:z(["reset","search"],["update:model"]),setup(h,{emit:G}){const d=G,{formRef:R,validate:c,restoreValidation:S}=se(),p=Y(h,"model"),U=Z(()=>{const{patternRules:_}=te();return{userEmail:_.email,userPhone:_.phone}});async function y(){await S(),d("reset")}async function P(){await c(),d("search")}return(_,m)=>{const f=ae,s=fe,N=ne,E=Oe,k=M,b=Me,D=re,x=Le,C=oe,v=$e,u=Be,o=le;return w(),T(o,{bordered:!1,size:"small",class:"card-wrapper"},{default:t(()=>[a(u,null,{default:t(()=>[a(v,{title:e(n)("common.search"),name:"user-search"},{default:t(()=>[a(C,{ref_key:"formRef",ref:R,model:p.value,rules:U.value,"label-placement":"left","label-width":80},{default:t(()=>[a(x,{responsive:"screen","item-responsive":""},{default:t(()=>[a(s,{span:"24 s:12 m:6",label:e(n)("page.manage.user.username"),path:"username",class:"pr-24px"},{default:t(()=>[a(f,{value:p.value.username,"onUpdate:value":m[0]||(m[0]=l=>p.value.username=l),placeholder:e(n)("page.manage.user.form.username")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(s,{span:"24 s:12 m:6",label:e(n)("page.manage.user.userGender"),path:"userGender",class:"pr-24px"},{default:t(()=>[a(N,{value:p.value.userGender,"onUpdate:value":m[1]||(m[1]=l=>p.value.userGender=l),placeholder:e(n)("page.manage.user.form.userGender"),options:e(H)(e(Q)),clearable:""},null,8,["value","placeholder","options"])]),_:1},8,["label"]),a(s,{span:"24 s:12 m:6",label:e(n)("page.manage.user.nickName"),path:"nickName",class:"pr-24px"},{default:t(()=>[a(f,{value:p.value.nickName,"onUpdate:value":m[2]||(m[2]=l=>p.value.nickName=l),placeholder:e(n)("page.manage.user.form.nickName")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(s,{span:"24 s:12 m:6",label:e(n)("page.manage.user.userPhone"),path:"userPhone",class:"pr-24px"},{default:t(()=>[a(f,{value:p.value.userPhone,"onUpdate:value":m[3]||(m[3]=l=>p.value.userPhone=l),placeholder:e(n)("page.manage.user.form.userPhone")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(s,{span:"24 s:12 m:6",label:e(n)("page.manage.user.userEmail"),path:"userEmail",class:"pr-24px"},{default:t(()=>[a(f,{value:p.value.userEmail,"onUpdate:value":m[4]||(m[4]=l=>p.value.userEmail=l),placeholder:e(n)("page.manage.user.form.userEmail")},null,8,["value","placeholder"])]),_:1},8,["label"]),a(s,{span:"24 s:12 m:6",label:e(n)("page.manage.user.userStatus"),path:"userStatus",class:"pr-24px"},{default:t(()=>[a(N,{value:p.value.status,"onUpdate:value":m[5]||(m[5]=l=>p.value.status=l),placeholder:e(n)("page.manage.user.form.userStatus"),options:e(H)(e(X)),clearable:""},null,8,["value","placeholder","options"])]),_:1},8,["label"]),a(s,{span:"24 m:12",class:"pr-24px"},{default:t(()=>[a(D,{class:"w-full",justify:"end"},{default:t(()=>[a(k,{onClick:y},{icon:t(()=>[a(E,{class:"text-icon"})]),default:t(()=>[L(" "+F(e(n)("common.reset")),1)]),_:1}),a(k,{type:"primary",ghost:"",onClick:P},{icon:t(()=>[a(b,{class:"text-icon"})]),default:t(()=>[L(" "+F(e(n)("common.search")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title"])]),_:1})]),_:1})}}}),ze={class:"min-h-500px flex-col-stretch gap-16px overflow-hidden lt-sm:overflow-auto"};function O(h){return typeof h=="function"||Object.prototype.toString.call(h)==="[object Object]"&&!Ce(h)}const He=A({name:"manage_user",__name:"index",setup(h){const G=De(),d=ee({}),{columns:R,columnChecks:c,data:S,getData:p,getDataByPage:U,loading:y,mobilePagination:P,searchParams:_,resetSearchParams:m}=ve({apiFn:we,showTotal:!0,apiParams:{current:1,size:10,status:null,username:null,userGender:null,nickName:null,userPhone:null,userEmail:null},columns:()=>[{type:"selection",align:"center",width:48},{key:"index",title:n("common.index"),align:"center",width:64},{key:"username",title:n("page.manage.user.username"),align:"center",minWidth:100},{key:"userGender",title:n("page.manage.user.userGender"),align:"center",width:100,render:o=>{if(o.userGender===null)return null;const l={1:"primary",2:"error"},r=n(Ne[o.userGender]);return a(J,{type:l[o.userGender]},O(r)?r:{default:()=>[r]})}},{key:"nickName",title:n("page.manage.user.nickName"),align:"center",minWidth:100},{key:"userPhone",title:n("page.manage.user.userPhone"),align:"center",width:120},{key:"userEmail",title:n("page.manage.user.userEmail"),align:"center",minWidth:200},{key:"status",title:n("page.manage.user.userStatus"),align:"center",width:100,render:o=>{if(o.status===null)return null;const l={1:"success",2:"warning"},r=n(ke[o.status]);return a(J,{type:l[o.status]},O(r)?r:{default:()=>[r]})}},{key:"operate",title:n("common.operate"),align:"center",width:130,render:o=>{let l;return a("div",{class:"flex-center gap-8px"},[a(M,{type:"primary",ghost:!0,size:"small",onClick:()=>u(o.uuid)},O(l=n("common.edit"))?l:{default:()=>[l]}),a(xe,{onPositiveClick:()=>v(o.uuid)},{default:()=>n("common.confirmDelete"),trigger:()=>{let r;return a(M,{loading:d[o.uuid],type:"error",ghost:!0,size:"small"},O(r=n("common.delete"))?r:{default:()=>[r]})}})])}}]}),{drawerVisible:f,operateType:s,editingData:N,handleAdd:E,handleEdit:k,checkedRowKeys:b,onBatchDeleted:D,onDeleted:x}=he(S,p);async function C(){const o=b.value.map(r=>Number.parseInt(r,10));o.forEach(r=>{d[r]=!0});const{error:l}=await q(o);o.forEach(r=>{d[r]=!1}),!l&&D()}async function v(o){const l=[o];d[o]=!0;const{error:r}=await q(l);d[o]=!1,!r&&x()}function u(o){k(o)}return(o,l)=>{const r=ye,B=be,I=le;return w(),j("div",ze,[a(Ie,{model:e(_),"onUpdate:model":l[0]||(l[0]=g=>$(_)?_.value=g:null),onReset:e(m),onSearch:e(U)},null,8,["model","onReset","onSearch"]),a(I,{title:e(n)("page.manage.user.title"),bordered:!1,size:"small",class:"sm:flex-1-hidden card-wrapper"},{"header-extra":t(()=>[a(r,{columns:e(c),"onUpdate:columns":l[1]||(l[1]=g=>$(c)?c.value=g:null),"disabled-delete":e(b).length===0,loading:e(y),"add-auth":"manage:user:add","delete-auth":"manage:user:delete",onAdd:e(E),onDelete:C,onRefresh:e(p)},null,8,["columns","disabled-delete","loading","onAdd","onRefresh"])]),default:t(()=>[a(B,{"checked-row-keys":e(b),"onUpdate:checkedRowKeys":l[2]||(l[2]=g=>$(b)?b.value=g:null),columns:e(R),data:e(S),size:"small","flex-height":!e(G).isMobile,"scroll-x":962,loading:e(y),remote:"","row-key":g=>g.uuid,pagination:e(P),class:"sm:h-full"},null,8,["checked-row-keys","columns","data","flex-height","loading","row-key","pagination"]),a(Fe,{visible:e(f),"onUpdate:visible":l[3]||(l[3]=g=>$(f)?f.value=g:null),"operate-type":e(s),"row-data":e(N),onSubmitted:e(U)},null,8,["visible","operate-type","row-data","onSubmitted"])]),_:1},8,["title"])])}}});export{He as default};
